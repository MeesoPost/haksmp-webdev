---
// USER: Vul hier je launch datum in!
// Formaat: 'YYYY-MM-DDTHH:MM:SS+01:00' (Nederlandse tijd)
const LAUNCH_DATE = '2025-12-01T18:00:00+01:00'; // ‚Üê AANPASSEN!
---

<div class="flip-clock">
  <h2 class="flip-clock__title">Seizoen 4 Start Over:</h2>
    
    <div class="flip-clock__cards" id="flip-clock-cards">
    <!-- Dagen -->
    <div class="flip-unit" data-unit="days">
      <div class="number current">60</div>
      <div class="number incoming">60</div>
      <div class="label">DAGEN</div>
    </div>

    <div class="separator">:</div>

    <!-- Uren -->
    <div class="flip-unit" data-unit="hours">
      <div class="number current">04</div>
      <div class="number incoming">04</div>
      <div class="label">UREN</div>
    </div>

    <div class="separator">:</div>

    <!-- Minuten -->
    <div class="flip-unit" data-unit="minutes">
      <div class="number current">49</div>
      <div class="number incoming">49</div>
      <div class="label">MINUTEN</div>
    </div>

    <div class="separator">:</div>

    <!-- Seconden -->
    <div class="flip-unit" data-unit="seconds">
      <div class="number current">23</div>
      <div class="number incoming">23</div>
      <div class="label">SECONDEN</div>
    </div>
  </div>

  <!-- Live status -->
  <div class="flip-clock__live" id="flip-clock-live" style="display: none;">
    <span class="flip-clock__live-indicator">‚óè</span>
    <span class="flip-clock__live-text">üéâ LIVE NOW!</span>
  </div>
</div>

<style>
  .flip-clock {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-lg) 0;
  }

  .flip-clock__title {
    font-family: var(--root-font-family--primary);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    color: var(--root-color--grey);
    text-align: center;
    margin-bottom: var(--space-sm);
    text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
  }

  .flip-clock__cards {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: wrap;
    justify-content: center;
  }

  .separator {
    font-family: var(--root-font-family--primary);
    font-size: 3rem;
    color: var(--root-color--support);
    font-weight: var(--root-font-weight--bold);
    line-height: 1;
    margin: 0 var(--space-xs);
    align-self: center;
  }

  /* Flip unit container - simplified */
  .flip-unit {
    position: relative;
    width: 100px;
    height: 120px;
    margin: 10px;
    text-align: center;
    background: var(--root-color--primary);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    overflow: hidden;
  }

  /* Basis nummer styling */
  .flip-unit .number {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--root-font-family--primary);
    font-size: 4rem;
    font-weight: var(--root-font-weight--bold);
    color: var(--root-color--white);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    background: linear-gradient(to bottom, 
      var(--root-color--secondary-light), 
      var(--root-color--secondary-dark));
  }

  /* Current nummer - normaal zichtbaar */
  .flip-unit .number.current {
    z-index: 1;
  }

  /* Incoming nummer - start boven het zicht */
  .flip-unit .number.incoming {
    transform: translateY(-100%);
    z-index: 2;
  }

  /* Tijdens animatie */
  .flip-unit.changing .number.current {
    /* Huidige nummer valt naar beneden */
    animation: fallDown 0.6s ease-in forwards;
  }

  .flip-unit.changing .number.incoming {
    /* Nieuwe nummer komt van boven */
    animation: dropDown 0.6s ease-out forwards;
  }

  @keyframes fallDown {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(100%);
      opacity: 0.3;
    }
  }

  @keyframes dropDown {
    0% {
      transform: translateY(-100%);
      opacity: 0.95;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Label positioning */

  /* Label */
  .label {
    position: absolute;
    bottom: -25px;
    width: 100%;
    text-align: center;
    font-family: var(--root-font-family--primary);
    font-size: 0.75rem;
    color: var(--root-color--grey);
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: var(--root-font-weight--bold);
  }

  /* Live indicator */
  .flip-clock__live {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-lg);
    background: var(--root-color--secondary);
    color: var(--root-color--white);
    border-radius: 8px;
    font-family: var(--root-font-family--primary);
    font-size: 1.5rem;
    font-weight: var(--root-font-weight--bold);
    animation: pulse-live 1.5s ease-in-out infinite;
  }

  @keyframes pulse-live {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .flip-clock__live-indicator {
    font-size: 2rem;
    color: var(--root-color--support);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .flip-unit {
      width: 70px;
      height: 90px;
    }

    .number {
      font-size: 3.5rem;
      line-height: 90px;
    }

    .lower-card .number {
      top: -45px;
    }

    .separator {
      font-size: 2rem;
    }

    .label {
      font-size: 0.625rem;
    }
  }

  @media (max-width: 480px) {
    .separator {
      display: none;
    }

    .flip-unit {
      width: 60px;
      height: 75px;
      margin: 5px;
    }

    .number {
      font-size: 3rem;
      line-height: 75px;
    }

    .lower-card .number {
      top: -37.5px;
    }
  }
</style>

<script define:vars={{ LAUNCH_DATE }}>
  // Countdown logic
  const targetDate = new Date(LAUNCH_DATE);
  let previousValues = {
    days: -1,
    hours: -1,
    minutes: -1,
    seconds: -1
  };

  function padNumber(num) {
    return num.toString().padStart(2, '0');
  }

  function updateFlipUnit(unit, newValue) {
    const flipUnit = document.querySelector(`[data-unit="${unit}"]`);
    if (!flipUnit) return;

    const formattedValue = padNumber(newValue);
    const oldValue = previousValues[unit] === -1 ? formattedValue : padNumber(previousValues[unit]);
    
    // Only animate if value actually changed
    if (oldValue === formattedValue) return;
    
    const currentNumber = flipUnit.querySelector('.number.current');
    const incomingNumber = flipUnit.querySelector('.number.incoming');
    
    if (!currentNumber || !incomingNumber) return;

    // Zet nieuwe waarde in incoming nummer
    incomingNumber.textContent = formattedValue;

    // Start dual animatie
    flipUnit.classList.add('changing');

    // Na animatie: wissel de rollen
    setTimeout(() => {
      // Current krijgt nieuwe waarde (voor volgende keer)
      currentNumber.textContent = formattedValue;
      
      // Stop animatie (reset posities)
      flipUnit.classList.remove('changing');
    }, 600);
  }

  function updateCountdown() {
    const now = new Date();
    const diff = targetDate - now;

    // Check if launch has happened
    if (diff <= 0) {
      const liveElement = document.getElementById('flip-clock-live');
      const cardsElement = document.getElementById('flip-clock-cards');
      
      if (liveElement) liveElement.style.display = 'flex';
      if (cardsElement) cardsElement.style.display = 'none';
      
      return; // Stop countdown
    }

    // Calculate time units
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    // Update cards only if value changed
    if (days !== previousValues.days) {
      updateFlipUnit('days', days);
      previousValues.days = days;
    }
    if (hours !== previousValues.hours) {
      updateFlipUnit('hours', hours);
      previousValues.hours = hours;
    }
    if (minutes !== previousValues.minutes) {
      updateFlipUnit('minutes', minutes);
      previousValues.minutes = minutes;
    }
    if (seconds !== previousValues.seconds) {
      updateFlipUnit('seconds', seconds);
      previousValues.seconds = seconds;
    }
  }

  // Initial setup
  setTimeout(() => {
    updateCountdown();
  }, 100);

  // Update every second
  setInterval(updateCountdown, 1000);
</script>