---
// USER: Vul hier je launch datum in!
// Formaat: 'YYYY-MM-DDTHH:MM:SS+01:00' (Nederlandse tijd)
const LAUNCH_DATE = '2025-12-01T18:00:00+01:00'; // ‚Üê AANPASSEN!
---

<div class="flip-clock">
  <h2 class="flip-clock__title">Seizoen 4 Start Over:</h2>
  
  <div class="flip-clock__cards" id="flip-clock-cards">
    <!-- Dagen -->
    <div class="flip-card" data-unit="days">
      <div class="flip-card__container">
        <!-- Static display -->
        <div class="flip-card__static">
          <div class="flip-card__top">
            <span class="flip-card__number" data-value="top-days">60</span>
          </div>
          <div class="flip-card__bottom">
            <span class="flip-card__number" data-value="bottom-days">60</span>
          </div>
        </div>
        
        <!-- Flip animation layer -->
        <div class="flip-card__flip-wrapper">
          <div class="flip-card__flipper">
            <div class="flip-card__flipper-front">
              <span class="flip-card__number" data-value="flip-front-days">60</span>
            </div>
            <div class="flip-card__flipper-back">
              <span class="flip-card__number" data-value="flip-back-days">60</span>
            </div>
          </div>
        </div>
      </div>
      <div class="flip-card__label">DAGEN</div>
    </div>

    <div class="flip-clock__separator">:</div>

    <!-- Uren -->
    <div class="flip-card" data-unit="hours">
      <div class="flip-card__container">
        <div class="flip-card__static">
          <div class="flip-card__top">
            <span class="flip-card__number" data-value="top-hours">04</span>
          </div>
          <div class="flip-card__bottom">
            <span class="flip-card__number" data-value="bottom-hours">04</span>
          </div>
        </div>
        <div class="flip-card__flip-wrapper">
          <div class="flip-card__flipper">
            <div class="flip-card__flipper-front">
              <span class="flip-card__number" data-value="flip-front-hours">04</span>
            </div>
            <div class="flip-card__flipper-back">
              <span class="flip-card__number" data-value="flip-back-hours">04</span>
            </div>
          </div>
        </div>
      </div>
      <div class="flip-card__label">UREN</div>
    </div>

    <div class="flip-clock__separator">:</div>

    <!-- Minuten -->
    <div class="flip-card" data-unit="minutes">
      <div class="flip-card__container">
        <div class="flip-card__static">
          <div class="flip-card__top">
            <span class="flip-card__number" data-value="top-minutes">49</span>
          </div>
          <div class="flip-card__bottom">
            <span class="flip-card__number" data-value="bottom-minutes">49</span>
          </div>
        </div>
        <div class="flip-card__flip-wrapper">
          <div class="flip-card__flipper">
            <div class="flip-card__flipper-front">
              <span class="flip-card__number" data-value="flip-front-minutes">49</span>
            </div>
            <div class="flip-card__flipper-back">
              <span class="flip-card__number" data-value="flip-back-minutes">49</span>
            </div>
          </div>
        </div>
      </div>
      <div class="flip-card__label">MINUTEN</div>
    </div>

    <div class="flip-clock__separator">:</div>

    <!-- Seconden -->
    <div class="flip-card" data-unit="seconds">
      <div class="flip-card__container">
        <div class="flip-card__static">
          <div class="flip-card__top">
            <span class="flip-card__number" data-value="top-seconds">23</span>
          </div>
          <div class="flip-card__bottom">
            <span class="flip-card__number" data-value="bottom-seconds">23</span>
          </div>
        </div>
        <div class="flip-card__flip-wrapper">
          <div class="flip-card__flipper">
            <div class="flip-card__flipper-front">
              <span class="flip-card__number" data-value="flip-front-seconds">23</span>
            </div>
            <div class="flip-card__flipper-back">
              <span class="flip-card__number" data-value="flip-back-seconds">23</span>
            </div>
          </div>
        </div>
      </div>
      <div class="flip-card__label">SECONDEN</div>
    </div>
  </div>

  <!-- Live status -->
  <div class="flip-clock__live" id="flip-clock-live" style="display: none;">
    <span class="flip-clock__live-indicator pulse">‚óè</span>
    <span class="flip-clock__live-text">üéâ LIVE NOW!</span>
  </div>
</div>

<style>
  .flip-clock {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-lg) 0;
  }

  .flip-clock__title {
    font-family: var(--root-font-family--primary);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    color: var(--root-color--grey);
    text-align: center;
    margin-bottom: var(--space-sm);
    text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
  }

  .flip-clock__cards {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: wrap;
    justify-content: center;
  }

  .flip-clock__separator {
    font-family: var(--root-font-family--primary);
    font-size: 3rem;
    color: var(--root-color--support);
    font-weight: var(--root-font-weight--bold);
    line-height: 1;
    margin: 0 var(--space-xs);
    padding-bottom: 30px;
    animation: blink 2s ease-in-out infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* Flip card structure */
  .flip-card {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .flip-card__container {
    position: relative;
    width: 100px;
    height: 120px;
    perspective: 400px;
    transform-style: preserve-3d;
  }

  /* Static background layers */
  .flip-card__static {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .flip-card__top,
  .flip-card__bottom {
    position: absolute;
    width: 100%;
    height: 50%;
    overflow: hidden;
    background: var(--root-color--secondary);
    border: 2px solid var(--root-color--secondary-dark);
  }

  .flip-card__top {
    top: 0;
    border-bottom-width: 1px;
    border-radius: 8px 8px 0 0;
    background: linear-gradient(to bottom, 
      var(--root-color--secondary), 
      var(--root-color--secondary-dark));
  }

  .flip-card__bottom {
    bottom: 0;
    border-top-width: 1px;
    border-radius: 0 0 8px 8px;
    background: linear-gradient(to bottom, 
      var(--root-color--secondary-dark), 
      var(--root-color--secondary-darkest));
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  /* Numbers that fill the cards */
  .flip-card__number {
    position: absolute;
    width: 100%;
    font-family: var(--root-font-family--primary);
    font-size: 5rem;
    font-weight: var(--root-font-weight--bold);
    color: var(--root-color--white);
    text-align: center;
    line-height: 120px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  /* Position numbers to be cut in half */
  .flip-card__top .flip-card__number {
    top: 0;
  }

  .flip-card__bottom .flip-card__number {
    top: -60px; /* Half the total height to show bottom half of number */
  }

  /* Flip animation wrapper */
  .flip-card__flip-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    z-index: 10;
    pointer-events: none;
  }

  .flip-card__flipper {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transform-origin: bottom;
  }

  .flip-card__flipper-front,
  .flip-card__flipper-back {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    backface-visibility: hidden;
    background: var(--root-color--secondary);
    border: 2px solid var(--root-color--secondary-dark);
    border-bottom-width: 1px;
    border-radius: 8px 8px 0 0;
  }

  .flip-card__flipper-front {
    background: linear-gradient(to bottom, 
      var(--root-color--secondary), 
      var(--root-color--secondary-dark));
    z-index: 2;
  }

  .flip-card__flipper-back {
    transform: rotateX(180deg);
    background: linear-gradient(to bottom, 
      var(--root-color--secondary), 
      var(--root-color--secondary-dark));
  }

  /* Position flip numbers */
  .flip-card__flipper-front .flip-card__number,
  .flip-card__flipper-back .flip-card__number {
    position: absolute;
    top: 0;
    width: 100%;
    font-size: 5rem;
    line-height: 120px;
  }

  /* Flip animation */
  .flip-card.flipping .flip-card__flipper {
    animation: flip 0.6s ease-in-out;
  }

  @keyframes flip {
    0% {
      transform: rotateX(0deg);
    }
    100% {
      transform: rotateX(-180deg);
    }
  }

  /* Label styling */
  .flip-card__label {
    margin-top: var(--space-xs);
    font-family: var(--root-font-family--primary);
    font-size: 0.75rem;
    color: var(--root-color--grey);
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: var(--root-font-weight--bold);
  }

  /* Live indicator */
  .flip-clock__live {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-lg);
    background: var(--root-color--secondary);
    color: var(--root-color--white);
    border-radius: 8px;
    font-family: var(--root-font-family--primary);
    font-size: 1.5rem;
    font-weight: var(--root-font-weight--bold);
    animation: pulse-live 1.5s ease-in-out infinite;
  }

  @keyframes pulse-live {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .flip-clock__live-indicator {
    font-size: 2rem;
    color: var(--root-color--support);
    animation: blink 1s ease-in-out infinite;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .flip-clock__container {
      width: 70px;
      height: 90px;
    }

    .flip-card__number {
      font-size: 3.5rem;
      line-height: 90px;
    }

    .flip-card__bottom .flip-card__number {
      top: -45px;
    }

    .flip-card__flipper-front .flip-card__number,
    .flip-card__flipper-back .flip-card__number {
      font-size: 3.5rem;
      line-height: 90px;
    }

    .flip-clock__separator {
      font-size: 2rem;
      padding-bottom: 20px;
    }

    .flip-card__label {
      font-size: 0.625rem;
    }
  }

  @media (max-width: 480px) {
    .flip-clock__separator {
      display: none;
    }

    .flip-card__container {
      width: 60px;
      height: 75px;
    }

    .flip-card__number {
      font-size: 3rem;
      line-height: 75px;
    }

    .flip-card__bottom .flip-card__number {
      top: -37.5px;
    }

    .flip-card__flipper-front .flip-card__number,
    .flip-card__flipper-back .flip-card__number {
      font-size: 3rem;
      line-height: 75px;
    }
  }
</style>

<script define:vars={{ LAUNCH_DATE }}>
  // Countdown logic
  const targetDate = new Date(LAUNCH_DATE);
  let previousValues = {
    days: -1,
    hours: -1,
    minutes: -1,
    seconds: -1
  };

  function padNumber(num) {
    return num.toString().padStart(2, '0');
  }

  function updateFlipCard(unit, newValue) {
    const card = document.querySelector(`[data-unit="${unit}"]`);
    if (!card) return;

    const formattedValue = padNumber(newValue);
    const oldValue = previousValues[unit] === -1 ? formattedValue : padNumber(previousValues[unit]);
    
    // Only animate if value actually changed
    if (oldValue === formattedValue) return;
    
    // Get all number elements
    const topNumber = card.querySelector(`[data-value="top-${unit}"]`);
    const bottomNumber = card.querySelector(`[data-value="bottom-${unit}"]`);
    const flipFront = card.querySelector(`[data-value="flip-front-${unit}"]`);
    const flipBack = card.querySelector(`[data-value="flip-back-${unit}"]`);

    // Set the flip animation values
    if (flipFront) flipFront.textContent = oldValue;
    if (flipBack) flipBack.textContent = formattedValue;

    // Start flip animation
    card.classList.add('flipping');

    // Update bottom number halfway through
    setTimeout(() => {
      if (bottomNumber) bottomNumber.textContent = formattedValue;
    }, 300);

    // Complete animation and update top
    setTimeout(() => {
      if (topNumber) topNumber.textContent = formattedValue;
      card.classList.remove('flipping');
    }, 600);
  }

  function updateCountdown() {
    const now = new Date();
    const diff = targetDate - now;

    // Check if launch has happened
    if (diff <= 0) {
      const liveElement = document.getElementById('flip-clock-live');
      const cardsElement = document.getElementById('flip-clock-cards');
      
      if (liveElement) liveElement.style.display = 'flex';
      if (cardsElement) cardsElement.style.display = 'none';
      
      return; // Stop countdown
    }

    // Calculate time units
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    // Update cards only if value changed
    if (days !== previousValues.days) {
      updateFlipCard('days', days);
      previousValues.days = days;
    }
    if (hours !== previousValues.hours) {
      updateFlipCard('hours', hours);
      previousValues.hours = hours;
    }
    if (minutes !== previousValues.minutes) {
      updateFlipCard('minutes', minutes);
      previousValues.minutes = minutes;
    }
    if (seconds !== previousValues.seconds) {
      updateFlipCard('seconds', seconds);
      previousValues.seconds = seconds;
    }
  }

  // Initial setup
  setTimeout(() => {
    updateCountdown();
  }, 100);

  // Update every second
  setInterval(updateCountdown, 1000);
</script>